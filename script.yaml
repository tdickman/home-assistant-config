bathroom_timer_on_awake:
  alias: "Turn on bathroom light and set timer"
  sequence:
    # Cancel ev. old timers
    - service: script.turn_off
      data:
         entity_id: script.bathroom_timer_off_awake
    - service: light.turn_on
      data:
        entity_id: group.bathroom
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bathroom_timer_off_awake
bathroom_timer_on_sleeping:
  alias: "Turn on bathroom light and set timer"
  sequence:
    # Cancel ev. old timers
    - service: script.turn_off
      data:
         entity_id: script.bathroom_timer_off_sleeping
    - service: light.turn_on
      entity_id: light.bathroom_1
      data:
        brightness: 5
        color_temp: 455
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bathroom_timer_off_sleeping

bathroom_timer_off_awake:
  alias: "Turn off bathroom light after 4 minutes. Keep lights on if humidty exceeds thermostat humidty by 15%"
  sequence:
    - delay:
        minutes: 4
    - service: homeassistant.turn_off
      entity_id: switch.fluxer
    - service_template: > 
        {% if (is_state('binary_sensor.motion_sensor_158d00012dae15', 'on')) or (states('sensor.humidity_158d00011003cd') | float) > (states('sensor.hallway_thermostat_humidity') | float + 20) %}
          script.turn_on
        {% else %}
          light.turn_off
        {% endif %}
      data_template:
        entity_id: >
          {% if (is_state('binary_sensor.motion_sensor_158d00012dae15', 'on')) or (states('sensor.humidity_158d00011003cd') | float) > (states('sensor.hallway_thermostat_humidity') | float + 20) %}
            script.bathroom_timer_off_awake_restart
          {% else %}
            group.bathroom
          {% endif %}
    - service: homeassistant.turn_on
      entity_id: switch.fluxer

bathroom_timer_off_sleeping:
  alias: "Turn off bathroom light after 4 minutes. Keep lights on if humidty exceeds thermostat humidty by 15%"
  sequence:
    - delay:
        minutes: 4
    - service_template: > 
        {% if (is_state('binary_sensor.motion_sensor_158d00012dae15', 'on')) or (states('sensor.humidity_158d00011003cd') | float) > (states('sensor.hallway_thermostat_humidity') | float + 20) %}
          script.turn_on
        {% else %}
          light.turn_off
        {% endif %}
      data_template:
        entity_id: >
          {% if (is_state('binary_sensor.motion_sensor_158d00012dae15', 'on')) or (states('sensor.humidity_158d00011003cd') | float) > (states('sensor.hallway_thermostat_humidity') | float + 20) %}
            script.bathroom_timer_off_sleeping_restart
          {% else %}
            group.bathroom
          {% endif %}

bathroom_timer_off_awake_restart:
  alias: "Turn off bathroom light after 5 minutes (restart)"
  sequence:
    # Cancel current script
    - service: script.turn_off
      data:
        entity_id: script.bathroom_timer_off_awake
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bathroom_timer_off_awake

bathroom_timer_off_sleeping_restart:
  alias: "Turn off bathroom light after 5 minutes (restart)"
  sequence:
    # Cancel current script
    - service: script.turn_off
      data:
        entity_id: script.bathroom_timer_off_sleeping
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bathroom_timer_off_sleeping

bedroom_timer_on:
  alias: "Turn on bedroom light and set timer"
  sequence:
    # Cancel ev. old timers
    - service: script.turn_off
      data:
         entity_id: script.bedroom_timer_off
    - service: light.turn_on
      data:
        entity_id: group.bedroom
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bedroom_timer_off

bedroom_timer_off:
  alias: "Turn off bedroom light after 5 minutes"
  sequence:
    - delay:
        minutes: 5
    - service: homeassistant.turn_off
      entity_id: switch.fluxer
    - service_template: > 
        {% if (is_state('binary_sensor.motion_sensor_158d0001535b7c', 'on'))  %}
          script.turn_on
        {% else %}
          light.turn_off
        {% endif %}
      data_template:
        entity_id: >
          {% if (is_state('binary_sensor.motion_sensor_158d0001535b7c', 'on'))  %}
            script.bedroom_timer_off_restart
          {% else %}
            group.bedroom
          {% endif %}
    - service: homeassistant.turn_on
      entity_id: switch.fluxer

bedroom_timer_off_restart:
  alias: "Turn off bedroom light after 5 minutes (restart)"
  sequence:
    # Cancel current script
    - service: script.turn_off
      data:
        entity_id: script.bedroom_timer_off
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bedroom_timer_off

tv_volume_up:
  sequence:
    - service: broadlink.send_packet_192_168_1_193
      data:
        packet: 
          - 'JgBYAAABKZIVERQ1FREUERQRFBEUERQRFDYUERQ2FDYUNRQ2FDYUERQSExIUNRQ2FBEUERQRFBIUNRU1FBEUERQ2FDYUNhQ1FAAFOAABKkgUAAxLAAEpSRQADQU='

tv_volume_down:
  sequence:
    - service: broadlink.send_packet_192_168_1_193
      data:
        packet: 
          - 'JgBYAAABKZMUERQ2FBEUERQRFBEUERQSFDUUEhQ1FDYUNhQ2FDYUERQ2FBEUERQ2FDYUERQRFBEUERQ2FDYUERQRFDYUNhQ1FAAFOAABKkgVAAxKAAEqSBQADQU='
