bathroom_timer_on_awake:
  alias: "Turn on bathroom light and set timer"
  sequence:
    # Cancel ev. old timers
    - service: script.turn_off
      data:
         entity_id: script.bathroom_timer_off
    - service: light.turn_on
      data:
        entity_id: group.bathroom
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bathroom_timer_off
bathroom_timer_on_sleeping:
  alias: "Turn on bathroom light and set timer"
  sequence:
    # Cancel ev. old timers
    - service: script.turn_off
      data:
         entity_id: script.bathroom_timer_off
    - service: light.turn_on
      entity_id: light.bathroom_1
      data:
        brightness: 5
        color_temp: 455
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bathroom_timer_off

bathroom_timer_off:
  alias: "Turn off bathroom light after 5 minutes. Keep lights on if humidty exceeds thermostat humidty by 15%"
  sequence:
    - delay:
        minutes: 5
    - service_template: > 
        {% if (is_state('binary_sensor.motion_sensor_158d00012dae15', 'on')) or (states('sensor.humidity_158d00011003cd') | float) > (states('sensor.hallway_thermostat_humidity') | float + 20) %}
          script.turn_on
        {% else %}
          light.turn_off
        {% endif %}
      data_template:
        entity_id: >
          {% if (is_state('binary_sensor.motion_sensor_158d00012dae15', 'on')) or (states('sensor.humidity_158d00011003cd') | float) > (states('sensor.hallway_thermostat_humidity') | float + 20) %}
            script.bathroom_timer_off_restart
          {% else %}
            group.bathroom
          {% endif %}

bathroom_timer_off_restart:
  alias: "Turn off bathroom light after 5 minutes (restart)"
  sequence:
    # Cancel current script
    - service: script.turn_off
      data:
        entity_id: script.bathroom_timer_off
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bathroom_timer_off

bedroom_timer_on:
  alias: "Turn on bedroom light and set timer"
  sequence:
    # Cancel ev. old timers
    - service: script.turn_off
      data:
         entity_id: script.bedroom_timer_off
    - service: light.turn_on
      data:
        entity_id: group.bedroom
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bedroom_timer_off

bedroom_timer_off:
  alias: "Turn off bedroom light after 5 minutes"
  sequence:
    - delay:
        minutes: 5
    - service_template: > 
        {% if (is_state('binary_sensor.motion_sensor_158d0001535b7c', 'on'))  %}
          script.turn_on
        {% else %}
          light.turn_off
        {% endif %}
      data_template:
        entity_id: >
          {% if (is_state('binary_sensor.motion_sensor_158d0001535b7c', 'on'))  %}
            script.bedroom_timer_off_restart
          {% else %}
            group.bedroom
          {% endif %}

bedroom_timer_off_restart:
  alias: "Turn off bedroom light after 5 minutes (restart)"
  sequence:
    # Cancel current script
    - service: script.turn_off
      data:
        entity_id: script.bedroom_timer_off
    # Set new timer
    - service: script.turn_on
      data:
        entity_id: script.bedroom_timer_off
